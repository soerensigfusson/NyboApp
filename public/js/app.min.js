"use strict";!function(){function a(a,b,c){}function b(a){a.theme("default").primaryPalette("blue-grey")}a.$inject=["$rootScope","$localStorage","$cordovaGlobalization"],b.$inject=["$mdThemingProvider"],angular.module("App",["app.templates","App.Services","App.Components","App.Filters","ui.router","ngMaterial","ngAnimate","ngSanitize","ngStorage","ngCordova","firebase"]).run(a).config(b)}(),function(){function a(a,b){a.$on("$stateChangeError",function(a,c,d,e,f,g){"AUTH_REQUIRED"===g&&b.go("login")})}function b(a,b){b.otherwise("/home"),a.state("home",{url:"/home",controller:"HomeController",templateUrl:"Pages/Home/home.tmpl.html",resolve:{currentAuth:["Auth",function(a){return a.$requireSignIn()}]}}).state("login",{url:"/login",controller:"LoginController",templateUrl:"Pages/Login/login.tmpl.html",resolve:{currentAuth:["Auth",function(a){return a.$waitForSignIn()}]}}).state("home.account",{url:"/account",controller:"AccountController",templateUrl:"Pages/Account/account.tmpl.html"}).state("home.users",{url:"/users",abstract:!0,controller:"UserController",template:"<ui-view />"}).state("home.users.list",{url:"/",templateUrl:"Pages/Users/list.tmpl.html"}).state("home.users.add",{url:"/users",templateUrl:"Pages/Users/add-user.tmpl.html"}).state("home.orders",{url:"/orders",abstract:!0,controller:"OrdersController",template:"<ui-view />"}).state("home.orders.list",{url:"/",templateUrl:"Pages/Orders/orders.tmpl.html"}).state("home.orders.add",{url:"/add",controller:"OrderController",templateUrl:"Pages/Orders/add-order.tmpl.html"}).state("home.orders.edit",{url:"/edit/:id",controller:"OrderController",templateUrl:"Pages/Orders/add-order.tmpl.html",resolve:{currentAuth:["Auth",function(a){return a.$waitForSignIn()}]}}).state("home.orders.order",{url:"/:id",controller:"OrderController",templateUrl:"Pages/Orders/order.tmpl.html",resolve:{currentAuth:["Auth",function(a){return a.$waitForSignIn()}]}}).state("home.orders.order.details",{templateUrl:"Pages/Orders/order.details.tmpl.html"}).state("home.orders.order.materials",{templateUrl:"Pages/Orders/order.materials.tmpl.html"}).state("home.orders.order.time",{templateUrl:"Pages/Orders/order.time.tmpl.html"})}b.$inject=["$stateProvider","$urlRouterProvider"],a.$inject=["$rootScope","$state"],angular.module("App").config(b).run(a)}(),function(){angular.module("App.Components",["App.Components.Uploader"])}(),function(){function a(a){function b(b,c,d){function e(a){this.x=Math.random()*t,this.y=Math.random()*u-u,this.r=i(10,30),this.d=Math.random()*x+10,this.color=a,this.tilt=Math.floor(10*Math.random())-10,this.tiltAngleIncremental=.07*Math.random()+.05,this.tiltAngle=0,this.draw=function(){return s.beginPath(),s.lineWidth=this.r/2,s.strokeStyle=this.color,s.moveTo(this.x+this.tilt+this.r/4,this.y),s.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),s.stroke()}}function f(){r=document.querySelectorAll(".confetti")[0],s=r.getContext("2d"),t=window.innerWidth,u=window.innerHeight,r.width=t,r.height=u}function g(){y=[],C=!1;for(var a=0;a<x;a++){var b=D.getColor();y.push(new e(b))}n()}function h(){s.clearRect(0,0,t,u);for(var a=[],b=0;b<x;b++)!function(b){a.push(y[b].draw())}(b);return j(),a}function i(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function j(){var a,b=0;z+=.01,A+=.1;for(var c=0;c<x;c++){if(a=y[c],C)return;!B&&a.y<-15?a.y=u+100:(l(a,c),a.y<=u&&b++,k(a,c))}0===b&&q()}function k(a,b){(a.x>t+20||a.x<-20||a.y>u)&&B&&(b%5>0||b%2==0?m(a,Math.random()*t,-10,Math.floor(10*Math.random())-10):Math.sin(z)>0?m(a,-5,Math.random()*u,Math.floor(10*Math.random())-10):m(a,t+5,Math.random()*u,Math.floor(10*Math.random())-10))}function l(a,b){a.tiltAngle+=a.tiltAngleIncremental,a.y+=(Math.cos(z+a.d)+3+a.r/2)/2,a.x+=Math.sin(z),a.tilt=15*Math.sin(a.tiltAngle-b/3)}function m(a,b,c,d){a.x=b,a.y=c,a.tilt=d}function n(){t=window.innerWidth,u=window.innerHeight,r.width=t,r.height=u,function a(){return C?null:(w=requestAnimFrame(a),h())}()}function o(){clearTimeout(v),clearTimeout(w)}function p(){B=!1,o()}function q(){C=!0,void 0!==s&&s.clearRect(0,0,t,u)}b.duration=b.duration||800;var r,s,t,u,v,w,x=100,y=[],z=0,A=0,B=!0,C=!0,D={colorOptions:["#3AC1A3","#FFE27C","#FF5757","#97CDFF","#2C97FF","#0000FF"],colorIndex:0,colorIncrementer:0,getColor:function(){return this.colorIncrementer>=10&&(this.colorIncrementer=0,this.colorIndex++,this.colorIndex>=this.colorOptions.length&&(this.colorIndex=0)),this.colorIncrementer++,this.colorOptions[this.colorIndex]}};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),angular.element(document).ready(function(){f(),g(),a(function(){p()},b.duration)})}var c={restrict:"E",templateUrl:"Components/Confetti/confetti.tpl.html",link:b,scope:{duration:"@"}};return c}a.$inject=["$timeout"],angular.module("App.Components.Confetti",["app.templates"]).directive("confetti",a)}(),function(){function a(a){function c(a,b,c){console.log("link"),b[0].addEventListener("change",d.bind(this,a.uploader),!1)}function d(a,c){for(var d=c.target.files,e=function(){h=d[f];var c="";new b({maxWidth:200,maxHeight:200,file:h,onSuccess:function(a){c=a}}).createThumbnail();var e=g.child(h.name);e.put(h).then(function(b){a()(b,c,h.name,e)})},f=0;f<d.length;f++){var h;e()}}var e=firebase.storage(),f=e.ref(),g=f.child("images"),h={restrict:"A",link:c,scope:{uploader:"&"}};return h}function b(a){this.options={file:a.file,maxWidth:a.maxWidth||120,maxHeight:a.maxHeight||120,onError:a.onError&&a.onError.bind(this),onSuccess:a.onSuccess&&a.onSuccess.bind(this)}}a.$inject=["$timeout"],angular.module("App.Components.Uploader",[]).directive("uploader",a),b.prototype.detectVerticalSquash=function(a){if(void 0===a.naturalHeight)return 1;var b,c,d,e,f,g,h,i,j;for(g=a.naturalHeight,c=document.createElement("canvas"),c.width=1,c.height=g,d=c.getContext("2d"),d.drawImage(a,0,0),e=d.getImageData(0,0,1,g).data,j=0,f=g,h=g;h>j;)b=e[4*(h-1)+3],0===b?f=h:j=h,h=f+j>>1;return i=h/g,0===i?1:i},b.prototype.createThumbnail=function(){this.options.file.type.match(/image.*/)?this.createThumbnailFromImageFile():this.options.file.type.match(/video.*/)?this.createThumbnailFromVideoFile():this.options.onError&&this.options.onError()},b.prototype.createThumbnailFromImageFile=function(){var a=new FileReader;a.addEventListener("load",function(){this.createThumbnailFromUrl(a.result)}.bind(this)),a.readAsDataURL(this.options.file)},b.prototype.createThumbnailFromVideoFile=function(){this.createVideoThumbnailFromUrl(URL.createObjectURL(this.options.file))},b.prototype.createVideoThumbnailFromUrl=function(a){var b,c;return c=document.createElement("video"),c.style="display: none",document.body.appendChild(c),b=c.canPlayType(this.options.file.type),"no"===b||""===b?void(this.options.onError&&this.options.onError()):(c.addEventListener("loadeddata",function(){this.options.onSuccess&&this.options.onSuccess(this.getThumbnailDataURL(c,c.videoWidth,c.videoHeight)),document.body.removeChild(c)}.bind(this),!1),c.addEventListener("error",function(){this.options.onError&&this.options.onError(),document.body.removeChild(c)}.bind(this),!1),void(c.src=a))},b.prototype.createThumbnailFromUrl=function(a,b){var c=document.createElement("img");b&&(c.crossOrigin=b),this.options.onSuccess&&(c.onload=function(){this.options.onSuccess(this.getThumbnailDataURL(c,c.width,c.height))}.bind(this)),this.options.onError&&(c.onerror=this.options.onError),c.src=a},b.prototype.getResizeInformation=function(a,b){var c={srcX:0,srcY:0,srcWidth:a,srcHeight:b,trgWidth:void 0,trgHeight:void 0},d=a/b,e=this.options.maxWidth,f=this.options.maxHeight;e||f?e?f||(f=1/d*e):e=d*f:(e=c.srcWidth,f=c.srcHeight);var g=e/f;return b<f||a<e?(c.trgHeight=c.srcHeight,c.trgWidth=c.srcWidth):d>g?(c.srcHeight=b,c.srcWidth=c.srcHeight*g):(c.srcWidth=a,c.srcHeight=c.srcWidth/g),c.srcX=(a-c.srcWidth)/2,c.srcY=(b-c.srcHeight)/2,void 0===c.trgWidth&&(c.trgWidth=e),void 0===c.trgHeight&&(c.trgHeight=f),c},b.prototype.getThumbnailDataURL=function(a,b,c){var d=this.detectVerticalSquash(a),e=this.getResizeInformation(b,c),f=document.createElement("canvas");return f.width=e.trgWidth,f.height=e.trgHeight,f.getContext("2d").drawImage(a,e.srcX,e.srcY,e.srcWidth,e.srcHeight,0,0,e.trgWidth,e.trgHeight/d),f.toDataURL("image/png")}}(),function(){angular.module("App.Filters",["App.Filters.Minutes","App.Filters.ToDate"])}(),function(){function a(){return function(a){return a?Math.floor(a/60).toString().padStart(2,"0")+":"+(a%60).toString().padStart(2,"0"):"00:00"}}return angular.module("App.Filters.Minutes",[]).filter("minutes",a),a}(),function(){function a(){return function(a){return a?new Date(a):""}}return angular.module("App.Filters.ToDate",[]).filter("todate",a),a}(),function(){function a(a,b,c){a.firebaseUser=c.$getAuth(),console.log(a.firebaseUser),a.signout=function(){c.$signOut()}}a.$inject=["$scope","$state","Auth"],angular.module("App").controller("AccountController",a)}(),function(){function a(a,b,c,d,e){a.firebaseUser=c.$getAuth(),e.$loaded().then(function(b){var c=e.find(function(b){return b.uid===a.firebaseUser.uid});a.username=c.name}),a.toggleNavigation=function(){d("left").toggle()},a.signout=function(){c.$signOut().then(function(){b.go("login")})}}a.$inject=["$scope","$state","Auth","$mdSidenav","Users"],angular.module("App").controller("HomeController",a)}(),function(){function a(a,b,c){console.log(c),a.createUser=function(){a.message=null,a.error=null,c.$createUserWithEmailAndPassword(a.email,a.password).then(function(b){a.message="User created with uid: "+b.uid}).catch(function(b){a.error=b})},a.login=function(){a.message=null,a.error=null,c.$signInWithEmailAndPassword(a.email,a.password).then(function(a){b.go("home")}).catch(function(b){a.error=b})}}a.$inject=["$scope","$state","Auth"],angular.module("App").controller("LoginController",a)}(),function(){function a(a,c,d,e,f,g,h,i){function j(){c.orders.forEach(function(a){a.materials.forEach(function(a){n.indexOf(a.name)===-1&&n.push(a.name)})})}function k(a){var b=angular.lowercase(a);return function(a){return 0===a.indexOf(b)}}c.orders=g,c.timelist=b,c.addrSearch={},c.currentNavItem="details";var l=["vejnavne","adgangsadresser","adresser"],m=0,n=[],o=h.$getAuth();c.materialSearch=function(a){var b=a?n.filter(k(a)):n;return b},c.selectAddress=function(){m=m==l.length-1?0:m+1,c.addrSearch.selectedItem.adresse&&(c.orders.address=c.addrSearch.selectedItem.text)},c.querySearch=function(b){var c=l[m],d={url:"http://dawa.aws.dk/"+c+"/autocomplete",method:"GET",params:{q:b}},f=a.defer();return e(d).then(function(a){f.resolve(a.data)}),f.promise},f.id?g.$loaded().then(function(a){j(),c.order=g.$getRecord(f.id),c.order.startdate&&(c.order.startdate=new Date(c.order.startdate)),c.order.enddate&&(c.order.enddate=new Date(c.order.enddate))}):c.order={},c.saveOrder=function(){c.order.startdate&&"string"!=typeof c.order.startdate&&(c.order.startdate=c.order.startdate.toString()),c.order.enddate&&"string"!=typeof c.order.enddate&&(c.order.enddate=c.order.enddate.toString()),void 0===c.order.$id?(g.$add(c.order),d.go("^.list")):(g.$save(c.order),d.go("^.order",{id:c.order.$id}))},c.deleteOrder=function(){g.$remove(c.order),d.go("^.list")},c.newmaterial={name:"",amount:0},c.addMaterial=function(){c.newmaterial.name=c.newmaterial.name||c.newmaterial.materialSearchText,delete c.newmaterial.materialSearchText,!c.newmaterial.name||c.newmaterial.amount<=0||(c.order.materials||(c.order.materials=[]),c.order.materials.push(c.newmaterial),g.$save(c.order).then(function(){c.newmaterial={}}))},c.deleteMaterial=function(a){c.order.materials.splice(a,1),g.$save(c.order)},c.newtimereg={date:new Date,time:60,description:""},c.addTimereg=function(){c.newtimereg.time<=0||(c.newtimereg.user=o.uid,c.order.timeregistrations||(c.order.timeregistrations=[]),c.newtimereg.date&&"string"!=typeof c.newtimereg.date&&(c.newtimereg.date=c.newtimereg.date.toString()),c.order.timeregistrations.push(c.newtimereg),g.$save(c.order).then(function(){c.newtimereg={date:new Date,time:0,description:""}}))},c.deleteTimereg=function(a){c.order.timeregistrations.splice(a,1),g.$save(c.order)},c.getUsername=function(a){var b=i.find(function(b){return b.uid===a});return b?b.name:"----"},c.onFileUploaded=function(a,b){c.order.files||(c.order.files=[]),c.order.files.push({url:a.downloadUrl,thumbnail:b}),console.log(a,b)}}a.$inject=["$q","$scope","$state","$http","$stateParams","Orders","Auth","Users"],angular.module("App").controller("OrderController",a);for(var b=[],c=0;c<48;c++){var d=(c%2*30).toString().padStart(2,"0"),e=Math.floor(c/2).toString().padStart(2,"0");b.push({title:e+":"+d,minutes:30*c})}}(),function(){function a(a,b,c){a.orders=c,a.addOrder=function(){b.go("^.add")},a.openOrder=function(a){b.go("^.order.details",{id:a.$id})}}a.$inject=["$scope","$state","Orders"],angular.module("App").controller("OrdersController",a)}(),function(){function a(a,b,c,d){a.currentUser=c.$getAuth().uid,console.log(d),a.users=d,a.user={},a.addUser=function(){b.go("^.add")},a.createUser=function(){a.message=null,a.error=null,c.$createUserWithEmailAndPassword(a.user.email,a.user.password).then(function(c){a.message="User created with uid: "+c.uid;var e={name:a.user.name,email:a.user.email,uid:c.uid};d.$add(e),a.user={},c.updateProfile({displayName:a.user.name}),b.go("^.list")}).catch(function(b){a.error=b})},a.delete=function(a){}}a.$inject=["$scope","$state","Auth","Users"],angular.module("App").controller("UserController",a)}(),function(){function a(a){return a()}a.$inject=["$firebaseAuth"],angular.module("App.Services.Auth",[]).factory("Auth",a)}(),function(){function a(a){var b=firebase.database().ref().child("orders");return a(b)}a.$inject=["$firebaseArray"],angular.module("App.Services.Orders",[]).factory("Orders",a)}(),function(){angular.module("App.Services",["App.Services.Auth","App.Services.Orders","App.Services.Users"])}(),function(){function a(a){var b=firebase.database().ref().child("users");return a(b)}a.$inject=["$firebaseArray"],angular.module("App.Services.Users",[]).factory("Users",a)}();
//# sourceMappingURL=app.min.js.map